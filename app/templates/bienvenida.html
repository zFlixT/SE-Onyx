<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SE Onyx — Asistente de Compras</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Estilos globales -->
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="welcome-body">
  <div class="container">
    <div class="hero-card">
      <div class="row g-4 align-items-center">
        <!-- Izquierda: texto -->
        <div class="col-md-7 text-section">
          <span class="badge-custom">SE Onyx — Sistema Experto</span>
          <h1 class="title display-5">Asistente de Compras</h1>
          <p class="lead-text">
            Un sistema experto conectado a Internet que busca y recomienda productos reales según tus necesidades,
            presupuesto y preferencias. Basado en razonamiento híbrido (reglas + casos) y aprendizaje continuo con feedback.
          </p>
          <div class="mt-3">
            <button class="btn-main" data-bs-toggle="modal" data-bs-target="#loginModal">
              Iniciar sesión para entrar →
            </button>
            <div class="version-note">v1.0 • Todo funcional!</div>
          </div>
        </div>

        <!-- Derecha: logo -->
        <div class="col-md-5">
          <div class="logo-wrap">
            <img src="/static/img/logo.png" alt="Logo SEAC" class="logo">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Login / Registro -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <ul class="nav nav-tabs mb-3" id="loginRegisterTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">Iniciar Sesión</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button">Registrarse</button>
          </li>
        </ul>

        <div class="tab-content">
          <!-- LOGIN -->
          <div class="tab-pane fade show active" id="login" role="tabpanel">
            <form id="loginForm">
              <div class="mb-3">
                <label class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="loginEmail" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="loginPassword" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
            </form>
          </div>

          <!-- REGISTRO -->
          <div class="tab-pane fade" id="register" role="tabpanel">
            <form id="registerForm">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" class="form-control" id="regFirstName" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Apellido</label>
                <input type="text" class="form-control" id="regLastName" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="regEmail" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="regPassword" required>
              </div>
              <button type="submit" class="btn btn-success w-100">Crear Cuenta</button>
            </form>
          </div>
        </div>

        <p id="msg" class="text-center mt-3"></p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // LOGIN
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      const msg = document.getElementById("msg");

      try {
        const res = await fetch(`/users/login?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`, { method: "POST" });
        const data = await res.json();
        if (res.ok && data.ok) {
          msg.textContent = "Inicio de sesión exitoso ✅";
          msg.style.color = "green";
          localStorage.setItem("user_id", data.user_id);
          localStorage.setItem("user_email", email);
          localStorage.setItem("user_name", data.first_name || "");
          setTimeout(() => window.location.href = "/index", 700);
        } else {
          msg.textContent = data.detail || "Error al iniciar sesión.";
          msg.style.color = "red";
        }
      } catch {
        msg.textContent = "Error de conexión con el servidor.";
        msg.style.color = "red";
      }
    });

    // REGISTRO
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const firstName = document.getElementById("regFirstName").value;
      const lastName = document.getElementById("regLastName").value;
      const email = document.getElementById("regEmail").value;
      const password = document.getElementById("regPassword").value;
      const msg = document.getElementById("msg");

      try {
        const res = await fetch(`/users/register?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}&first_name=${encodeURIComponent(firstName)}&last_name=${encodeURIComponent(lastName)}`, { method: "POST" });
        const data = await res.json();
        if (res.ok && data.ok) {
          msg.textContent = "Cuenta creada correctamente ✅";
          msg.style.color = "green";
          localStorage.setItem("user_id", data.user_id);
          localStorage.setItem("user_email", email);
          localStorage.setItem("user_name", `${firstName} ${lastName}`);
          setTimeout(() => window.location.href = "/index", 700);
        } else {
          msg.textContent = data.detail || "Error al registrar usuario.";
          msg.style.color = "red";
        }
      } catch {
        msg.textContent = "Error de conexión con el servidor.";
        msg.style.color = "red";
      }
    });
  </script>
</body>
</html>